# Worldpay Checkout Server

This is the backend server for the Worldpay checkout application. It provides API endpoints for processing payments using Worldpay's payment gateway.

## Setup

1. Install dependencies:
```bash
cd server
npm install
```

2. Create a `.env` file in the server directory with the following variables:
```
SERVER_PORT=4000
CLIENT_URL=http://localhost:3000
NODE_ENV=development
WORLDPAY_USERNAME=your_worldpay_username
WORLDPAY_PASSWORD=your_worldpay_password
```

3. Build the TypeScript code:
```bash
npm run build
```

## Running the Server

To start the server in development mode with hot reloading:
```bash
npm run dev
```

To start the server in production mode:
```bash
npm run start
```

## API Endpoints

### Process Payment
- **URL**: `/api/payments/process`
- **Method**: `POST`
- **Body**:
  ```json
  {
    "session": "worldpay-session-token",
    "amount": 1000,
    "currency": "GBP"
  }
  ```
- **Success Response**:
  ```json
  {
    "success": true,
    "transactionId": "Memory265-13/08/1876",
    "message": "Payment authorized successfully",
    "details": {
      "outcome": "authorized",
      "transactionReference": "Memory265-13/08/1876",
      "paymentHref": "https://try.access.worldpay.com/api/payments/...",
      "cardDetails": {
        "cardBrand": "mastercard",
        "lastFour": "1000",
        "expiryDate": {
          "month": 5,
          "year": 2035
        }
      },
      "authorizationCode": "675725",
      "actions": {
        "cancelPayment": {
          "href": "https://try.access.worldpay.com/api/payments/.../cancellations",
          "method": "POST"
        },
        "settlePayment": {
          "href": "https://try.access.worldpay.com/api/payments/.../settlements",
          "method": "POST"
        }
      }
    }
  }
  ```
- **Error Response**:
  ```json
  {
    "success": false,
    "error": "Payment processing failed",
    "message": "The payment was not authorized",
    "details": {
      // Full error response from Worldpay API
    }
  }
  ```

## Worldpay API Integration

The server integrates with the Worldpay API to process payments. The integration uses the session token generated by the Worldpay checkout SDK on the frontend.

Key features:
- Secure payment processing using Worldpay's API
- Session-based card payments
- Detailed transaction information returned to the frontend
- Error handling for failed payments

To use your own Worldpay account, update the `WORLDPAY_USERNAME` and `WORLDPAY_PASSWORD` in the `.env` file.

## Implementation Notes

The implementation includes a full integration with the Worldpay Payments API. The server processes payments using the session token generated by the checkout SDK and returns detailed payment information to the frontend. 